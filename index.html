<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ALOE Kiosk Feedback Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- ALOE ORGANIC BRAND PALETTE --- */
    :root {
      --aloe-primary: #8B5A2B;
      --aloe-accent: #6B8E23;
      --aloe-bg-warm: #F9F6F0;
      --aloe-bg-container: #FFFFFF;
      --aloe-text-dark: #3E2B1F;
      --aloe-text-light: #8C7B70;
      --aloe-border: #E8E0D5;
      --aloe-progress-inactive: #E0D6C8;
      --aloe-error: #D9534F;
    }

    * {
      box-sizing: border-box;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--aloe-bg-warm) 0%, #F3EDE2 100%);
      color: var(--aloe-text-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    /* --- Main App Container --- */
    .app {
      width: 100%;
      max-width: 480px;
      background: var(--aloe-bg-container);
      border-radius: 30px;
      box-shadow: 0 20px 40px -10px rgba(62, 43, 31, 0.15);
      padding: 32px;
      border: 1px solid #F0EAE2;
      text-align: center;
      position: relative;
      overflow: hidden;
      min-height: 650px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .app::before {
        content: '';
        position: absolute; top: 0; left: 0; right: 0;
        height: 6px;
        background: linear-gradient(to right, var(--aloe-primary), var(--aloe-accent));
    }

    /* --- HEADER (Progress Bar Only) --- */
    .header-container {
      position: absolute;
      top: 30px;
      left: 0;
      right: 0;
      transition: opacity 0.3s;
    }
    .hidden { opacity: 0; pointer-events: none; }

    .progress-bar {
      display: flex;
      justify-content: center;
      gap: 8px;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--aloe-progress-inactive);
      transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }

    .progress-dot.active {
      background-color: var(--aloe-accent);
      transform: scale(1.3);
    }
    .progress-dot.completed {
        background-color: var(--aloe-accent);
    }

    /* --- Typography --- */
    h1 {
      font-size: 26px;
      font-weight: 700;
      margin: 0 0 12px;
      color: var(--aloe-text-dark);
      line-height: 1.3;
    }

    p.subtitle {
      margin: 0 auto 32px;
      font-size: 16px;
      color: var(--aloe-text-light);
      line-height: 1.5;
      max-width: 90%;
    }

    /* --- Animations --- */
    .step { display: none; width: 100%; animation: fadeIn 0.5s ease; }
    .step.active { display: block; }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }

    /* --- STEP 0: QR SCAN --- */
    .qr-wrapper {
      margin: 0 auto 30px;
      padding: 20px;
      border: 2px dashed var(--aloe-border);
      border-radius: 20px;
      display: inline-block;
      cursor: pointer;
      background: #FAFAFA;
      transition: all 0.2s;
    }
    .qr-wrapper:active {
      transform: scale(0.96);
      border-color: var(--aloe-accent);
      background: #F4F8ED;
    }
    .qr-image {
      width: 180px;
      height: 180px;
      display: block;
      background-image: url('https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=ALOE-KIOSK-DEMO&color=3E2B1F');
      background-size: contain;
      opacity: 0.9;
    }
    .tap-hint {
        font-size: 13px;
        color: var(--aloe-accent);
        font-weight: 600;
        margin-top: 15px;
        animation: pulse 2s infinite;
    }
    .validity-note {
        font-size: 12px;
        color: var(--aloe-text-light);
        margin-top: 5px;
        font-style: italic;
    }
    @keyframes pulse { 0% {opacity: 0.6;} 50% {opacity: 1;} 100% {opacity: 0.6;} }


    /* --- Buttons --- */
    .buttons-stack {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    .btn {
      padding: 18px 24px;
      border-radius: 50px;
      border: 2px solid var(--aloe-border);
      background: var(--aloe-bg-container);
      color: var(--aloe-text-dark);
      font-size: 17px; font-weight: 600;
      display: flex; align-items: center; justify-content: center; gap: 12px;
      cursor: pointer; transition: all 0.2s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-icon { font-size: 22px; }

    .btn-primary {
      background: var(--aloe-primary);
      color: white; border: none;
      box-shadow: 0 4px 12px rgba(139, 90, 43, 0.3);
    }
    .btn-primary:hover { background: #7A4E25; }
    .btn-primary:disabled { background: #CDBBAE; box-shadow: none; cursor: not-allowed; }

    /* --- Step 2: Emojis --- */
    .emoji-row {
      display: flex; justify-content: center; gap: 20px; margin: 40px 0;
    }
    .btn-emoji {
      width: 85px; height: 85px; border-radius: 50%; font-size: 42px;
      border: 3px solid var(--aloe-border); background: #FFFFFF; cursor: pointer;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex; align-items: center; justify-content: center;
    }
    .btn-emoji.selected {
      border-color: var(--aloe-accent); background: #F4F8ED;
      transform: scale(1.15); box-shadow: 0 8px 16px rgba(107, 142, 35, 0.2);
    }

    /* --- Step 3: Chips --- */
    .chips-container {
        display: flex; flex-wrap: wrap; gap: 10px;
        justify-content: center; margin-bottom: 24px;
    }
    .chip {
      padding: 12px 18px; border-radius: 30px;
      border: 1px solid var(--aloe-border); background: #FAFAFA;
      color: var(--aloe-text-dark); font-size: 14px; font-weight: 500;
      cursor: pointer; transition: all 0.2s;
    }
    .chip.selected {
      background: var(--aloe-primary); color: white;
      border-color: var(--aloe-primary); box-shadow: 0 2px 8px rgba(139, 90, 43, 0.2);
    }

    textarea {
      width: 100%; min-height: 100px; resize: none;
      border-radius: 16px; border: 2px solid var(--aloe-border);
      padding: 14px; font-size: 15px; font-family: inherit;
      background: #FAFAFA; margin-bottom: 24px; color: var(--aloe-text-dark);
    }
    textarea:focus { outline: none; border-color: var(--aloe-primary); background: white; }

    /* --- Summary Box --- */
    .summary-box {
      background: #F4F8ED; border-radius: 20px; padding: 20px;
      text-align: left; margin-bottom: 24px;
    }
    .summary-item { margin-bottom: 8px; font-size: 15px; display: flex; }
    .summary-label { font-weight: 600; color: var(--aloe-primary); width: 90px; }

    /* --- Footer --- */
    .footer {
      margin-top: 24px; font-size: 15px; color: var(--aloe-text-light);
      display: flex; justify-content: center; gap: 20px;
    }
    .link {
      cursor: pointer; color: var(--aloe-primary); font-weight: 600;
      text-decoration: none; transition: opacity 0.2s;
    }
    .link:hover { opacity: 0.8; }

    /* --- Success & Error Icons --- */
    .big-check { font-size: 72px; color: var(--aloe-accent); margin-bottom: 20px; display: block; }
    .big-error { font-size: 72px; color: var(--aloe-error); margin-bottom: 20px; display: block; }
    .final-message { font-size: 14px; color: var(--aloe-text-light); margin-top: 30px; font-weight: 500; }

    /* --- DEMO MODAL --- */
    .modal-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(8px);
        display: flex; flex-direction: column;
        align-items: center; justify-content: center;
        z-index: 100;
        opacity: 0; pointer-events: none;
        transition: opacity 0.3s;
    }
    .modal-overlay.visible {
        opacity: 1; pointer-events: auto;
    }
    .modal-box {
        background: white; border: 2px solid var(--aloe-border);
        padding: 32px 24px; border-radius: 24px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.1);
        width: 85%;
        text-align: center;
    }
    .modal-box h2 {
        font-size: 20px; color: var(--aloe-primary); margin-bottom: 12px;
    }
    .demo-badge {
        background: #333; color: white; padding: 4px 10px; border-radius: 12px;
        font-size: 11px; text-transform: uppercase; font-weight: 700; margin-bottom: 16px; display: inline-block;
    }
    .modal-desc {
        font-size: 13px; color: #666; line-height: 1.5; margin-bottom: 24px;
        background: #F5F5F5; padding: 12px; border-radius: 12px;
    }
    .modal-input {
        width: 100%; padding: 14px; border-radius: 12px;
        border: 2px solid var(--aloe-border);
        margin-bottom: 20px; font-size: 16px; text-align: center;
        font-family: inherit; font-weight: 600; color: var(--aloe-text-dark);
    }
    .modal-input:focus { border-color: var(--aloe-primary); outline: none; }

  </style>
</head>
<body>

  <div class="app">
    <div class="header-container hidden" id="mainHeader">
        <div class="progress-bar">
            <div class="progress-dot" id="dot1"></div>
            <div class="progress-dot" id="dot2"></div>
            <div class="progress-dot" id="dot3"></div>
            <div class="progress-dot" id="dot4"></div>
            <div class="progress-dot" id="dot5"></div>
        </div>
    </div>

    <div class="modal-overlay" id="simModal">
        <div class="modal-box">
            <span class="demo-badge">Demo Simulation</span>
            <h2>Identify Guest</h2>
            
            <p class="modal-desc">
                <strong>Note:</strong> In a real scenario, the QR Code automatically provides the 
                Guest Name, Stay Duration, and Services (e.g. Spa) without typing. 
                <br><br>
                This manual entry is only to simulate the data retrieval.
            </p>
            
            <input type="text" class="modal-input" id="simGuestName" placeholder="Enter Guest Name" value="Mario Rossi">
            <button class="btn-primary btn" style="width:100%; padding:14px;" onclick="confirmSimulation()">Confirm Scan</button>
        </div>
    </div>

    <div class="step active" id="step0" onclick="triggerScan()">
      <div class="qr-wrapper">
        <div class="qr-image"></div>
      </div>
      <h1>Welcome</h1>
      <p class="subtitle" style="margin-bottom: 10px;">Please place your QR code near the scanner.</p>
      
      <div class="validity-note">‚ö†Ô∏è QR valid for 20 mins after check-out</div>
      
      <p class="tap-hint">(Tap screen to simulate scan)</p>
    </div>


    <div class="step" id="step1">
      <h1>Share Your Feedback</h1>
      <p class="subtitle">How would you like to submit your review?</p>

      <div class="buttons-stack">
        <button class="btn" onclick="selectMode('anonymous')">
          <span class="btn-icon">üï∂Ô∏è</span> Submit Anonymously
        </button>
        <button class="btn" onclick="selectMode('named')">
          <span class="btn-icon">üë§</span> Submit as <span id="userNameDisplay" style="margin-left:5px; font-weight:700;">Guest Name</span>
        </button>
      </div>
    </div>

    <div class="step" id="step2">
      <h1>How was your stay?</h1>
      <p class="subtitle">Tap an emoji to rate your experience.</p>

      <div class="emoji-row">
        <button class="btn-emoji" id="emoji1" onclick="selectRating(1)">üòü</button>
        <button class="btn-emoji" id="emoji2" onclick="selectRating(2)">üòê</button>
        <button class="btn-emoji" id="emoji3" onclick="selectRating(3)">üôÇ</button>
      </div>

      <button class="btn-primary btn" id="btnNextStep2" onclick="goToStep(3)" disabled style="width:100%">Next step</button>
      <div class="footer">
        <span class="link" onclick="goToStep(1)">Back</span>
      </div>
    </div>

    <div class="step" id="step3">
      <h1>Add a quick comment?</h1>
      <p class="subtitle">Optional: Tap a tag or write a note.</p>

      <div class="chips-container">
        <div class="chip" onclick="applyTemplate(this, 'Perfect stay')">üëå Perfect stay</div>
        <div class="chip" onclick="applyTemplate(this, 'Staff was kind')">üè® Staff was kind</div>
        <div class="chip" onclick="applyTemplate(this, 'Great breakfast')">üç≥ Great breakfast</div>
        <div class="chip" onclick="applyTemplate(this, 'I had an issue')">‚ö†Ô∏è I had an issue</div>
      </div>
      
      <textarea id="commentInput" placeholder="Add message here (optional)..."></textarea>

      <button class="btn-primary btn" onclick="prepareSummary()" style="width:100%">Review Feedback</button>
      <div class="footer">
         <span class="link" onclick="prepareSummary()">Skip & Review</span>
      </div>
    </div>

    <div class="step" id="step4">
      <h1>Is this correct?</h1>
      <p class="subtitle">Please review before sending.</p>

      <div class="summary-box">
        <div class="summary-item"><span class="summary-label">Privacy:</span><span id="sumMode"></span></div>
        <div class="summary-item"><span class="summary-label">Rating:</span><span id="sumRating"></span></div>
        <div class="summary-item"><span class="summary-label">Note:</span><span id="sumComment"></span></div>
      </div>

      <button class="btn-primary btn" onclick="submitFeedback()" style="width:100%">üöÄ Send Feedback</button>
      <div class="footer">
        <span class="link" onclick="goToStep(3)">Edit details</span>
      </div>
    </div>

    <div class="step" id="step5">
      <div style="padding: 40px 0;">
        <span class="big-check">‚úÖ</span>
        <h1>Thank You!</h1>
        <p class="subtitle">Your feedback helps us improve.</p>
        <p class="final-message">Resetting in <span id="countdown">5</span> seconds...</p>
      </div>
    </div>

    <div class="step" id="step6">
      <div style="padding: 40px 0;">
        <span class="big-error">‚õî</span>
        <h1 style="color: var(--aloe-error); font-size:22px;">Already Received</h1>
        <p class="subtitle" id="errorMsgName">
          Feedback for this room/stay has already been submitted.
        </p>
        <p class="final-message">Resetting...</p>
      </div>
    </div>

  </div>

  <script>
    // MEMORIA DEI FEEDBACK INVIATI (Simulazione Database)
    // Usiamo un Set per memorizzare i nomi che hanno gi√† inviato
    const submittedGuests = new Set();

    let currentGuestName = "Guest";
    let feedbackData = { anonymous: true, rating: null, comment: "", tags: [] };
    let currentStep = 0; 
    const totalSteps = 5; 

    function updateProgressBar(stepNum) {
        if (stepNum === 0 || stepNum === 6) return;
        for (let i = 1; i <= totalSteps; i++) {
            const dot = document.getElementById('dot' + i);
            if (i === stepNum) {
                dot.classList.add('active'); dot.classList.remove('completed');
            } else if (i < stepNum) {
                dot.classList.add('completed'); dot.classList.remove('active');
            } else {
                dot.classList.remove('active', 'completed');
            }
        }
    }

    function goToStep(stepNum) {
      currentStep = stepNum;
      const header = document.getElementById('mainHeader');
      if (stepNum > 0 && stepNum < 6) {
          header.classList.remove('hidden');
      } else {
          header.classList.add('hidden');
      }

      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      document.getElementById('step' + stepNum).classList.add('active');
      if (stepNum > 0 && stepNum < 6) updateProgressBar(stepNum);
    }

    // --- LOGICA SIMULAZIONE (Click su QR) ---
    function triggerScan() {
        // Apri il modal per inserire il nome (o confermare quello di default)
        document.getElementById('simModal').classList.add('visible');
        // Focus sull'input
        setTimeout(() => document.getElementById('simGuestName').focus(), 100);
    }

    // --- CONFERMA NOME DAL MODAL ---
    function confirmSimulation() {
        const inputVal = document.getElementById('simGuestName').value.trim();
        const guestName = inputVal || "Guest"; 
        
        // Chiudi modal
        document.getElementById('simModal').classList.remove('visible');

        // CONTROLLO DUPLICATI: Se questo nome ha gi√† inviato, blocca!
        if (submittedGuests.has(guestName.toLowerCase())) {
            // Mostra errore personalizzato
            document.getElementById('errorMsgName').textContent = `Feedback for ${guestName} has already been submitted.`;
            goToStep(6); // Schermata Errore
            
            setTimeout(() => {
                goToStep(0); // Torna alla home
            }, 4000);
            return;
        }

        // Se √® un nuovo utente, procedi
        currentGuestName = guestName;
        document.getElementById('userNameDisplay').textContent = currentGuestName;
        
        // Simula caricamento breve e vai allo step 1
        document.body.style.cursor = 'wait';
        setTimeout(() => {
            document.body.style.cursor = 'default';
            goToStep(1);
        }, 400);
    }

    // Step 1 Fn
    function selectMode(mode) {
      feedbackData.anonymous = (mode === 'anonymous');
      goToStep(2);
    }

    // Step 2 Fn
    function selectRating(val) {
      feedbackData.rating = val;
      document.querySelectorAll('.btn-emoji').forEach(b => b.classList.remove('selected'));
      document.getElementById('emoji' + val).classList.add('selected');
      document.getElementById('btnNextStep2').disabled = false;
      setTimeout(() => goToStep(3), 300);
    }

    // Step 3 Fn
    function applyTemplate(el, text) {
      const textarea = document.getElementById("commentInput");
      textarea.value = text;
      feedbackData.comment = text;
      document.querySelectorAll(".chip").forEach(chip => {
        chip.classList.remove("selected");
      });
      el.classList.add("selected");
    }

    // Step 4 Fn
    function prepareSummary() {
      const text = document.getElementById('commentInput').value.trim();
      feedbackData.comment = text;

      document.getElementById('sumMode').textContent = feedbackData.anonymous 
        ? 'Anonymous' 
        : `Named (${currentGuestName})`;
      
      const ratings = {1: 'üòü Not Good', 2: 'üòê Okay', 3: 'üôÇ Great'};
      document.getElementById('sumRating').textContent = ratings[feedbackData.rating];
      document.getElementById('sumComment').textContent = feedbackData.comment || '(None)';
      goToStep(4);
    }

    // Step 5 Fn & SAVE to Memory
    function submitFeedback() {
      // SALVA IL NOME NELLA "MEMORIA" DEL CHIOSCO
      submittedGuests.add(currentGuestName.toLowerCase());
      
      console.log(`Feedback submitted for ${currentGuestName}`);
      goToStep(5);
      
      let seconds = 5;
      const counterEl = document.getElementById('countdown');
      const interval = setInterval(() => {
          seconds--;
          counterEl.textContent = seconds;
          if (seconds <= 0) {
              clearInterval(interval);
              // Reset manuale (non reload, per mantenere la memoria submittedGuests in questa sessione browser)
              resetKiosk(); 
          }
      }, 1000);
    }

    function resetKiosk() {
        goToStep(0);
        // Pulisci i campi
        document.getElementById("commentInput").value = "";
        document.querySelectorAll('.btn-emoji').forEach(b => b.classList.remove('selected'));
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
        document.getElementById('btnNextStep2').disabled = true;
        // Non puliamo submittedGuests cos√¨ la demo ricorda chi ha gi√† votato!
    }
  </script>
</body>
</html>
