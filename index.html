<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiosk Hotel - Privacy Gate</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #222; /* Sfondo scuro per far risaltare il Kiosk */
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .kiosk-wrapper {
            background: white;
            width: 100%;
            max-width: 450px;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        .header {
            background-color: #004d40;
            color: white;
            padding: 20px;
            text-align: center;
        }

        /* SCANNER AREA */
        #scan-screen {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #reader {
            width: 100%;
            border-radius: 15px;
            overflow: hidden;
            border: 4px solid #004d40;
        }

        /* SCHERMATA DI SCELTA (IL BIVIO) */
        #choice-screen {
            display: none; /* Nascosto all'inizio */
            padding: 40px 20px;
            text-align: center;
            flex-grow: 1;
            flex-direction: column;
            justify-content: center;
        }

        /* SCHERMATA FINALE (DASHBOARD) */
        #dashboard-screen {
            display: none; /* Nascosto all'inizio */
            padding: 20px;
            background-color: #f1f8e9;
            flex-grow: 1;
        }

        /* BOTTONI E STILI */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:active { transform: scale(0.98); }

        .btn-primary { background-color: #004d40; color: white; font-weight: bold; }
        .btn-secondary { background-color: #e0e0e0; color: #333; }
        .btn-ghost { background: transparent; border: 2px solid #004d40; color: #004d40; margin-top: 20px;}

        .user-avatar {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .info-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            background-color: #b2dfdb;
            color: #004d40;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="kiosk-wrapper">
        <div class="header">
            <h2>Grand Hotel Kiosk</h2>
        </div>

        <div id="scan-screen">
            <p>Inquadra il QR Code ricevuto all'ingresso</p>
            <div id="reader"></div>
        </div>

        <div id="choice-screen">
            <div class="user-avatar">ðŸ‘‹</div>
            <h3 id="choice-title">Utente Riconosciuto</h3>
            <p>Come vuoi proseguire?</p>
            
            <button class="btn btn-primary" onclick="proceedIdentified()">
                Continua come <span id="btn-name-label">...</span>
            </button>
            
            <button class="btn btn-secondary" onclick="proceedAnonymous()">
                Continua in Anonimo
            </button>
        </div>

        <div id="dashboard-screen">
            <h2 id="dash-greeting">Benvenuto</h2>
            
            <div id="personal-data-section">
                <div class="info-card">
                    <small>Stato Prenotazione</small>
                    <div id="dash-reason" style="font-weight:bold; font-size:1.2rem;">...</div>
                    <div style="margin-top:5px;">
                        <span class="tag" id="dash-duration">...</span>
                        <span class="tag" id="dash-room">...</span>
                    </div>
                </div>

                <div class="info-card">
                    <small>AttivitÃ  Incluse</small>
                    <ul id="dash-activities" style="padding-left:20px; margin:5px 0;"></ul>
                </div>
            </div>

            <div id="anonymous-message" style="display:none; text-align:center; padding:20px;">
                <p>Navigazione ospite attiva.<br>Scansiona di nuovo per accedere ai tuoi servizi personalizzati.</p>
            </div>

            <button class="btn btn-ghost" onclick="resetKiosk()">Esci / Scansiona di nuovo</button>
        </div>
    </div>

    <script>
        // DATI SIMULATI (Quelli che l'operatore ha inserito nel sistema)
        // Immagina che il QR contenga solo la chiave (es: GUEST-01)
        const database = {
            "GUEST-01": {
                nome: "Mario",
                cognome: "Rossi",
                durata: "3 Notti",
                motivo: "Viaggio di Lavoro",
                stanza: "204",
                attivita: ["Sala Meeting A", "Colazione Presto", "WiFi Alta VelocitÃ "]
            },
            "GUEST-02": {
                nome: "Elena",
                cognome: "Bianchi",
                durata: "7 Notti",
                motivo: "Vacanza Relax",
                stanza: "Suite Spa",
                attivita: ["Accesso Spa Illimitato", "Tour della CittÃ ", "Massaggio ore 18:00"]
            }
        };

        let html5QrcodeScanner;
        let currentUserData = null;

        function onScanSuccess(decodedText, decodedResult) {
            // 1. Cerco i dati nel database
            const data = database[decodedText];

            if (data) {
                // FERMO LA CAMERA
                html5QrcodeScanner.clear();
                
                // SALVO I DATI IN MEMORIA TEMPORANEA
                currentUserData = data;

                // 2. MOSTRO IL "BIVIO" (Choice Screen)
                // Nascondo lo scanner
                document.getElementById('scan-screen').style.display = 'none';
                // Popolo il bottone con il nome reale
                document.getElementById('btn-name-label').innerText = data.nome + " " + data.cognome;
                // Mostro la scelta
                document.getElementById('choice-screen').style.display = 'flex';

            } else {
                alert("QR Code non valido. Prova con GUEST-01 o GUEST-02");
            }
        }

        // SCELTA 1: UTENTE IDENTIFICATO
        function proceedIdentified() {
            document.getElementById('choice-screen').style.display = 'none';
            document.getElementById('dashboard-screen').style.display = 'block';

            // Mostro i dati personali
            document.getElementById('dash-greeting').innerText = "Ciao, " + currentUserData.nome + "!";
            document.getElementById('dash-reason').innerText = currentUserData.motivo; // Es: Lavoro, Spa, Tour
            document.getElementById('dash-duration').innerText = currentUserData.durata;
            document.getElementById('dash-room').innerText = "Stanza " + currentUserData.stanza;
            
            // Lista attivitÃ 
            const list = document.getElementById('dash-activities');
            list.innerHTML = ""; // Pulisco
            currentUserData.attivita.forEach(item => {
                let li = document.createElement("li");
                li.innerText = item;
                list.appendChild(li);
            });

            // Assicuro che la sezione dati sia visibile
            document.getElementById('personal-data-section').style.display = 'block';
            document.getElementById('anonymous-message').style.display = 'none';
        }

        // SCELTA 2: ANONIMO
        function proceedAnonymous() {
            document.getElementById('choice-screen').style.display = 'none';
            document.getElementById('dashboard-screen').style.display = 'block';

            // Nascondo i dati personali, mostro interfaccia generica
            document.getElementById('dash-greeting').innerText = "Benvenuto Ospite";
            document.getElementById('personal-data-section').style.display = 'none';
            document.getElementById('anonymous-message').style.display = 'block';
        }

        function resetKiosk() {
            location.reload(); // Ricarica la pagina per ricominciare da zero
        }

        // AVVIO SCANNER
        function startScanner() {
            html5QrcodeScanner = new Html5QrcodeScanner(
                "reader", { fps: 10, qrbox: 250 }, false);
            html5QrcodeScanner.render(onScanSuccess);
        }

        // Parte subito
        startScanner();

    </script>
</body>
</html>
