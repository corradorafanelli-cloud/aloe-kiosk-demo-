<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ALOE Kiosk Feedback Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- ALOE PREMIUM BRAND PALETTE --- */
    :root {
      --aloe-primary: #8B5A2B;    /* Marrone caldo elegante */
      --aloe-accent: #6B8E23;     /* Verde oliva per azioni positive */
      --aloe-bg-warm: #F9F6F0;    /* Beige crema sfondo */
      --aloe-bg-container: #FFFFFF;
      --aloe-text-dark: #3E2B1F;  /* Testo scuro coffee */
      --aloe-text-light: #8C7B70; /* Testo secondario */
      --aloe-border: #E8E0D5;
      --aloe-progress-inactive: #E0D6C8;
      --aloe-error: #D9534F;
      --aloe-info: #2b6cb0;
      --aloe-success-light: #E6FFFA;
      --aloe-success-border: #B2F5EA;
      --aloe-success-text: #2C7A7B;
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0; font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--aloe-bg-warm) 0%, #F3EDE2 100%);
      color: var(--aloe-text-dark);
      display: flex; align-items: center; justify-content: center;
      min-height: 100vh; padding: 20px;
    }

    /* --- APP CONTAINER --- */
    .app {
      width: 100%; max-width: 480px;
      background: var(--aloe-bg-container);
      border-radius: 30px;
      box-shadow: 0 20px 50px -10px rgba(62, 43, 31, 0.15);
      padding: 32px;
      border: 1px solid #F0EAE2;
      text-align: center;
      position: relative; overflow: hidden;
      min-height: 750px; /* Altezza aumentata per gestire il contenuto */
      display: flex; flex-direction: column; justify-content: center;
    }
    .app::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px;
        background: linear-gradient(to right, var(--aloe-primary), var(--aloe-accent));
    }

    /* --- HEADER --- */
    .header-container {
      position: absolute; top: 30px; left: 0; right: 0; transition: opacity 0.3s;
    }
    .hidden { opacity: 0; pointer-events: none; }

    .progress-bar { display: flex; justify-content: center; gap: 8px; }
    .progress-dot {
      width: 10px; height: 10px; border-radius: 50%;
      background-color: var(--aloe-progress-inactive);
      transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    .progress-dot.active { background-color: var(--aloe-accent); transform: scale(1.3); }
    .progress-dot.completed { background-color: var(--aloe-accent); }

    /* --- TYPOGRAPHY --- */
    h1 { font-size: 24px; font-weight: 700; margin: 0 0 10px; color: var(--aloe-text-dark); line-height: 1.3; }
    p.subtitle { margin: 0 auto 24px; font-size: 15px; color: var(--aloe-text-light); line-height: 1.5; max-width: 90%; }

    /* --- ANIMATIONS --- */
    .step { display: none; width: 100%; animation: fadeIn 0.5s ease; }
    .step.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

    /* --- STEP 0: QR SCAN --- */
    .qr-wrapper {
      margin: 0 auto 20px; padding: 20px;
      border: 2px dashed var(--aloe-border); border-radius: 20px;
      display: inline-block; cursor: pointer; background: #FAFAFA;
      transition: all 0.2s;
    }
    .qr-wrapper:active { transform: scale(0.96); border-color: var(--aloe-accent); background: #F4F8ED; }
    .qr-image {
      width: 180px; height: 180px; display: block;
      background-image: url('https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=ALOE-CHECKOUT-FEEDBACK&color=3E2B1F');
      background-size: contain; opacity: 0.9;
    }
    .tap-hint { font-size: 13px; color: var(--aloe-accent); font-weight: 600; margin-top: 15px; animation: pulse 2s infinite; }
    
    .validity-note {
        font-size: 13px; color: #856404; background: #FFF3CD;
        padding: 10px 16px; border-radius: 12px; display: inline-block; margin-bottom: 24px;
        border: 1px solid #FFEEBA; font-weight: 500;
    }
    @keyframes pulse { 0% {opacity: 0.6;} 50% {opacity: 1;} 100% {opacity: 0.6;} }

    /* --- BUTTONS --- */
    .buttons-stack { display: flex; flex-direction: column; gap: 16px; margin-bottom: 24px; }
    .btn {
      padding: 18px 24px; border-radius: 50px; border: 2px solid var(--aloe-border);
      background: var(--aloe-bg-container); color: var(--aloe-text-dark);
      font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 12px;
      cursor: pointer; transition: all 0.2s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-icon { font-size: 22px; }
    .btn-primary {
      background: var(--aloe-primary); color: white; border: none;
      box-shadow: 0 4px 12px rgba(139, 90, 43, 0.3);
    }
    .btn-primary:hover { background: #7A4E25; }
    .btn-primary:disabled { background: #CDBBAE; box-shadow: none; cursor: not-allowed; }

    /* --- STEP 2: EMOJIS --- */
    .emoji-row { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
    .btn-emoji {
      width: 85px; height: 85px; border-radius: 50%; font-size: 42px;
      border: 3px solid var(--aloe-border); background: #FFFFFF; cursor: pointer;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex; align-items: center; justify-content: center;
    }
    .btn-emoji.selected {
      border-color: var(--aloe-accent); background: #F4F8ED;
      transform: scale(1.15); box-shadow: 0 8px 16px rgba(107, 142, 35, 0.2);
    }

    /* --- STEP 3: CHIPS --- */
    .chips-container {
        display: flex; flex-wrap: wrap; gap: 8px;
        justify-content: center; margin-bottom: 20px;
    }
    .chip {
      padding: 10px 16px; border-radius: 20px;
      border: 1px solid var(--aloe-border); background: #FAFAFA;
      color: var(--aloe-text-dark); font-size: 13px; font-weight: 500;
      cursor: pointer; transition: all 0.2s; text-align: left;
    }
    .chip:hover { background: #F0F0F0; }
    .chip:active { transform: scale(0.95); background: var(--aloe-bg-warm); }

    textarea {
      width: 100%; min-height: 100px; resize: none;
      border-radius: 16px; border: 2px solid var(--aloe-border);
      padding: 14px; font-size: 15px; font-family: inherit;
      background: #FAFAFA; margin-bottom: 24px; color: var(--aloe-text-dark);
    }
    textarea:focus { outline: none; border-color: var(--aloe-primary); background: white; }

    /* --- STEP 4: REVIEW CARD --- */
    .preview-label {
        font-size: 11px; text-transform: uppercase; color: var(--aloe-accent);
        font-weight: 700; margin-bottom: 12px; display: block; letter-spacing: 1px;
    }
    .review-card {
        background: #FFFFFF;
        border: 1px solid #E0E0E0;
        border-radius: 16px;
        padding: 24px;
        text-align: left;
        margin-bottom: 24px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.06);
        position: relative;
    }
    .review-header {
        display: flex; align-items: center; margin-bottom: 16px; position: relative; z-index: 1;
    }
    .review-avatar {
        width: 44px; height: 44px; border-radius: 50%;
        background: var(--aloe-bg-warm);
        display: flex; align-items: center; justify-content: center;
        font-size: 22px; margin-right: 12px;
        color: var(--aloe-primary); border: 1px solid var(--aloe-border);
    }
    .review-info h3 {
        margin: 0; font-size: 15px; font-weight: 600; color: var(--aloe-text-dark);
    }
    .review-info span {
        font-size: 11px; color: var(--aloe-text-light); display: block; margin-top: 2px;
    }
    .review-stars {
        color: #FFC107; font-size: 18px; margin-bottom: 12px; display: block;
    }
    .review-body {
        font-size: 14px; line-height: 1.6; color: #444;
        font-style: italic; position: relative; z-index: 1;
    }

    /* --- FOOTER --- */
    .footer {
      margin-top: 24px; font-size: 14px; color: var(--aloe-text-light);
      display: flex; justify-content: center; gap: 24px;
    }
    .link {
      cursor: pointer; color: var(--aloe-primary); font-weight: 600;
      text-decoration: none; transition: opacity 0.2s;
    }
    .link:hover { opacity: 0.8; }

    /* --- SUCCESS & ERROR --- */
    .big-check { font-size: 72px; color: var(--aloe-accent); margin-bottom: 20px; display: block; }
    .big-error { font-size: 72px; color: var(--aloe-error); margin-bottom: 20px; display: block; }
    .final-message { font-size: 14px; color: var(--aloe-text-light); margin-top: 30px; font-weight: 500; }

    /* --- MODAL --- */
    .modal-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .modal-overlay.visible { opacity: 1; pointer-events: auto; }
    .modal-box {
        background: white; border: 2px solid var(--aloe-border);
        padding: 28px; border-radius: 24px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.1); width: 90%; text-align: center;
    }
    .demo-badge {
        background: #333; color: white; padding: 4px 10px; border-radius: 12px;
        font-size: 10px; text-transform: uppercase; font-weight: 700; margin-bottom: 16px; display: inline-block;
    }
    .info-row {
        display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px;
        border-bottom: 1px solid #eee; padding-bottom: 8px;
    }
    .info-label { color: #888; font-weight: 500; }
    .info-val { font-weight: 600; color: var(--aloe-text-dark); }
    
    /* Nuovi stili per il box di accesso */
    .access-note {
        background: var(--aloe-success-light); border: 1px solid var(--aloe-success-border); color: var(--aloe-success-text);
        padding: 12px; border-radius: 12px; font-size: 13px; margin-top: 15px; font-weight: 600; line-height: 1.4;
    }
    
    .access-subnote {
        font-size: 11px; color: #666; margin-top: 8px; margin-bottom: 20px; font-style: italic; line-height: 1.3;
    }

    .modal-input {
        width: 100%; padding: 14px; border-radius: 12px; border: 2px solid var(--aloe-border);
        margin-bottom: 10px; font-size: 16px; text-align: center; font-weight: 600; color: var(--aloe-text-dark);
    }
    .modal-input:focus { border-color: var(--aloe-primary); outline: none; }
    
    .modal-hint {
        font-size: 11px; color: #999; margin-bottom: 20px;
    }

  </style>
</head>
<body>

  <div class="app">
    <!-- HEADER -->
    <div class="header-container hidden" id="mainHeader">
        <div class="progress-bar">
            <div class="progress-dot" id="dot1"></div>
            <div class="progress-dot" id="dot2"></div>
            <div class="progress-dot" id="dot3"></div>
            <div class="progress-dot" id="dot4"></div>
            <div class="progress-dot" id="dot5"></div>
        </div>
    </div>

    <!-- MODAL SIMULAZIONE (Il "Popup" richiesto) -->
    <div class="modal-overlay" id="simModal">
        <div class="modal-box">
            <span class="demo-badge" style="background: var(--aloe-accent);">SYSTEM CHECK: QR Data Read</span>
            <h2 style="font-size: 18px; color: var(--aloe-primary); margin-bottom: 20px;">Verification Successful</h2>
            
            <!-- Dati simulati letti dal QR -->
            <div class="info-row">
                <span class="info-label">Guest Name:</span>
                <span class="info-val" id="modalGuestName">Mario Rossi</span>
            </div>
            <div class="info-row">
                <span class="info-label">Package:</span>
                <span class="info-val">Chianti Wine Tour</span>
            </div>
            <div class="info-row">
                <span class="info-label">Stay:</span>
                <span class="info-val">3 Nights</span>
            </div>

            <!-- Nota Sicurezza aggiornata -->
            <div class="access-note">
                ‚úÖ Access granted. You can now leave your review.
            </div>
            <div class="access-subnote">
                (Review will appear on ALOE only if the user booked an ALOE Package)
            </div>
            
            <!-- Input per la Demo -->
            <div style="text-align:left; font-size: 12px; font-weight:600; color:var(--aloe-primary); margin-bottom:5px;">Demo Note:</div>
            <div class="modal-hint" style="margin-bottom:10px;">
                You can edit the name here to simulate different guests.
            </div>
            <input type="text" class="modal-input" id="simGuestName" placeholder="Enter Guest Name" value="Mario Rossi" style="margin-bottom: 10px;">
            
            <button class="btn-primary btn" style="width:100%; padding:14px;" onclick="confirmSimulation()">Confirm & Continue</button>
        </div>
    </div>

    <!-- STEP 0: STANDBY -->
    <div class="step active" id="step0" onclick="triggerScan()">
      <!-- Avviso 20 Minuti (Spostato all'inizio) -->
      <div class="validity-note">‚ö†Ô∏è QR valid for 20 mins after check-out</div>
      
      <div class="qr-wrapper">
        <div class="qr-image"></div>
      </div>
      <h1>Welcome</h1>
      <p class="subtitle">Please place your QR code near the scanner.</p>
      
      <p class="tap-hint">(Tap screen to simulate scan)</p>
    </div>


    <!-- STEP 1: Privacy Choice -->
    <div class="step" id="step1">
      <h1>Share Your Feedback</h1>
      <p class="subtitle">How would you like to submit your review?</p>

      <div class="buttons-stack">
        <button class="btn" onclick="selectMode('anonymous')">
          <span class="btn-icon">üï∂Ô∏è</span> Submit Anonymously
        </button>
        <button class="btn" onclick="selectMode('named')">
          <span class="btn-icon">üë§</span> Submit as <span id="userNameDisplay" style="margin-left:5px; font-weight:700;">Mario Rossi</span>
        </button>
      </div>
    </div>

    <!-- STEP 2: Rating -->
    <div class="step" id="step2">
      <h1>How was your stay?</h1>
      <p class="subtitle">Tap an emoji to rate your experience.</p>

      <div class="emoji-row">
        <button class="btn-emoji" id="emoji1" onclick="selectRating(1)">üòü</button>
        <button class="btn-emoji" id="emoji2" onclick="selectRating(2)">üòê</button>
        <button class="btn-emoji" id="emoji3" onclick="selectRating(3)">üôÇ</button>
      </div>

      <button class="btn-primary btn" id="btnNextStep2" onclick="goToStep(3)" disabled style="width:100%">Next step</button>
      <div class="footer">
        <span class="link" onclick="goToStep(1)">Back</span>
      </div>
    </div>

    <!-- STEP 3: Details -->
    <div class="step" id="step3">
      <h1>Add a quick comment?</h1>
      <p class="subtitle">Tap phrases to build your review.</p>

      <div class="chips-container">
        <div class="chip" onclick="addTemplate('The room was perfectly clean and comfortable.')">‚ú® Room was perfect</div>
        <div class="chip" onclick="addTemplate('The staff was incredibly welcoming and helpful.')">üè® Staff was amazing</div>
        <div class="chip" onclick="addTemplate('The breakfast had great variety and quality.')">üç≥ Delicious breakfast</div>
        <div class="chip" onclick="addTemplate('The check-in process was a bit slow.')">üê¢ Slow check-in</div>
      </div>
      
      <textarea id="commentInput" placeholder="Add message here (optional)..."></textarea>

      <button class="btn-primary btn" onclick="prepareSummary()" style="width:100%">Preview Review</button>
      <div class="footer">
         <span class="link" onclick="prepareSummary()">Skip & Preview</span>
      </div>
    </div>

    <!-- STEP 4: Review Card Preview -->
    <div class="step" id="step4">
      <h1>Review Preview</h1>
      <p class="subtitle">Confirm your submission details.</p>

      <!-- CARD STYLE -->
      <div class="review-card">
          <div class="review-header">
              <div class="review-avatar">
                  <span id="cardAvatarIcon">üë§</span>
              </div>
              <div class="review-info">
                  <h3 id="cardName">Mario Rossi</h3>
                  <!-- Specificato il pacchetto ALOE -->
                  <span id="cardDate">Chianti Wine Tour ‚Ä¢ Verified Guest</span>
              </div>
          </div>
          <div class="review-stars" id="cardStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div class="review-body" id="cardComment">
              "The room was perfectly clean and comfortable."
          </div>
      </div>

      <button class="btn-primary btn" onclick="submitFeedback()" style="width:100%">üöÄ Publish Feedback</button>
      <div class="footer">
        <span class="link" onclick="goToStep(3)">Edit text</span>
      </div>
    </div>

    <!-- STEP 5: Thanks -->
    <div class="step" id="step5">
      <div style="padding: 40px 0;">
        <span class="big-check">‚úÖ</span>
        <h1>Thank You!</h1>
        <p class="subtitle">Your feedback is now live on ALOE.</p>
        <p class="final-message">Resetting in <span id="countdown">5</span> seconds...</p>
      </div>
    </div>

    <!-- STEP 6: ERROR -->
    <div class="step" id="step6">
      <div style="padding: 40px 0;">
        <span class="big-error">‚õî</span>
        <h1 style="color: var(--aloe-error); font-size:22px;">Already Received</h1>
        <p class="subtitle" id="errorMsgName">
          Feedback for this package has already been submitted by the booker.
        </p>
        <p class="final-message">Resetting...</p>
      </div>
    </div>

  </div>

  <script>
    const submittedGuests = new Set();
    let currentGuestName = "Mario Rossi"; 
    let feedbackData = { anonymous: true, rating: null, comment: "" };
    let currentStep = 0; 
    const totalSteps = 5; 

    function updateProgressBar(stepNum) {
        if (stepNum === 0 || stepNum === 6) return;
        for (let i = 1; i <= totalSteps; i++) {
            const dot = document.getElementById('dot' + i);
            if (i === stepNum) {
                dot.classList.add('active'); dot.classList.remove('completed');
            } else if (i < stepNum) {
                dot.classList.add('completed'); dot.classList.remove('active');
            } else {
                dot.classList.remove('active', 'completed');
            }
        }
    }

    function goToStep(stepNum) {
      currentStep = stepNum;
      const header = document.getElementById('mainHeader');
      if (stepNum > 0 && stepNum < 6) header.classList.remove('hidden');
      else header.classList.add('hidden');

      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      document.getElementById('step' + stepNum).classList.add('active');
      if (stepNum > 0 && stepNum < 6) updateProgressBar(stepNum);
    }

    function triggerScan() {
        // Check if already submitted
        if (submittedGuests.has(currentGuestName.toLowerCase())) {
            goToStep(6); 
            setTimeout(() => { goToStep(0); }, 4000);
            return;
        }
        // Show Simulation Modal
        document.getElementById('simModal').classList.add('visible');
    }

    function confirmSimulation() {
        const inputVal = document.getElementById('simGuestName').value.trim();
        const guestName = inputVal || "Guest"; 
        document.getElementById('simModal').classList.remove('visible');

        // Controllo duplicati (Case insensitive)
        if (submittedGuests.has(guestName.toLowerCase())) {
            document.getElementById('errorMsgName').textContent = `Feedback for ${guestName} (Chianti Wine Tour) has already been submitted.`;
            goToStep(6); 
            setTimeout(() => { goToStep(0); }, 4000);
            return;
        }

        currentGuestName = guestName;
        document.getElementById('userNameDisplay').textContent = currentGuestName;
        document.body.style.cursor = 'wait';
        setTimeout(() => {
            document.body.style.cursor = 'default';
            goToStep(1);
        }, 400);
    }

    function selectMode(mode) {
      feedbackData.anonymous = (mode === 'anonymous');
      goToStep(2);
    }

    function selectRating(val) {
      feedbackData.rating = val;
      document.querySelectorAll('.btn-emoji').forEach(b => b.classList.remove('selected'));
      document.getElementById('emoji' + val).classList.add('selected');
      document.getElementById('btnNextStep2').disabled = false;
      setTimeout(() => goToStep(3), 300);
    }

    // LOGICA CUMULATIVA TEMPLATE
    function addTemplate(text) {
      const textarea = document.getElementById("commentInput");
      let currentText = textarea.value.trim();
      
      if (currentText.length > 0 && !currentText.endsWith('.') && !currentText.endsWith('!')) {
          currentText += ". ";
      } else if (currentText.length > 0) {
          currentText += " ";
      }
      
      textarea.value = currentText + text;
      event.currentTarget.style.transform = "scale(0.95)";
      setTimeout(() => event.currentTarget.style.transform = "scale(1)", 150);
    }

    function prepareSummary() {
      const text = document.getElementById('commentInput').value.trim();
      feedbackData.comment = text;

      if (feedbackData.anonymous) {
          document.getElementById('cardName').textContent = "Anonymous Guest";
          document.getElementById('cardAvatarIcon').textContent = "üï∂Ô∏è";
      } else {
          document.getElementById('cardName').textContent = currentGuestName;
          document.getElementById('cardAvatarIcon').textContent = "üë§";
      }

      const date = new Date();
      const options = { month: 'short', day: 'numeric', year: 'numeric' };
      // AGGIORNATO: Mostra il pacchetto specifico
      document.getElementById('cardDate').textContent = `Chianti Wine Tour ‚Ä¢ ${date.toLocaleDateString('en-US', options)}`;

      const starsMap = { 1: '‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ', 2: '‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ', 3: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ' };
      const starsColor = { 1: '#D9534F', 2: '#F0AD4E', 3: '#6B8E23' }; 
      
      const starEl = document.getElementById('cardStars');
      starEl.textContent = starsMap[feedbackData.rating] || '‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ';
      starEl.style.color = starsColor[feedbackData.rating] || '#ccc';

      document.getElementById('cardComment').textContent = 
        feedbackData.comment ? `"${feedbackData.comment}"` : "No written comment.";

      goToStep(4);
    }

    function submitFeedback() {
      submittedGuests.add(currentGuestName.toLowerCase());
      goToStep(5);
      
      let seconds = 5;
      const counterEl = document.getElementById('countdown');
      const interval = setInterval(() => {
          seconds--;
          counterEl.textContent = seconds;
          if (seconds <= 0) {
              clearInterval(interval);
              resetKiosk(); 
          }
      }, 1000);
    }

    function resetKiosk() {
        goToStep(0);
        document.getElementById("commentInput").value = "";
        document.querySelectorAll('.btn-emoji').forEach(b => b.classList.remove('selected'));
        document.getElementById('btnNextStep2').disabled = true;
    }
  </script>
</body>
</html>
